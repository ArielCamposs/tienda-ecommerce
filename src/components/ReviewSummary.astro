---
import StarRating from "./StarRating.astro";

interface Props {
    average: number;
    count: number;
    distribution: {
        5: number;
        4: number;
        3: number;
        2: number;
        1: number;
    };
}

const { average, count, distribution } = Astro.props;

// Calcular porcentajes para las barras
const getPercentage = (ratingCount: number) => {
    if (count === 0) return 0;
    return Math.round((ratingCount / count) * 100);
};

const ratings = [5, 4, 3, 2, 1] as const;
---

<div class="review-summary">
    <div class="summary-header">
        <div class="average-section">
            <div class="average-number">{average.toFixed(1)}</div>
            <StarRating rating={average} size="lg" />
            <p class="total-reviews">
                {count}
                {count === 1 ? "reseña" : "reseñas"}
            </p>
        </div>

        <div class="distribution-section">
            {
                ratings.map((rating) => {
                    const ratingCount = distribution[rating];
                    const percentage = getPercentage(ratingCount);

                    return (
                        <div class="rating-row">
                            <span class="rating-label">{rating}</span>
                            <svg
                                class="star-small"
                                xmlns="http://www.w3.org/2000/svg"
                                viewBox="0 0 20 20"
                                fill="currentColor"
                            >
                                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                            </svg>
                            <div class="progress-bar-container">
                                <div
                                    class="progress-bar"
                                    style={`width: ${percentage}%`}
                                />
                            </div>
                            <span class="rating-count">{ratingCount}</span>
                        </div>
                    );
                })
            }
        </div>
    </div>
</div>

<style>
    .review-summary {
        background: #f9fafb;
        border-radius: 0.75rem;
        padding: 2rem;
        margin-bottom: 2rem;
    }

    .summary-header {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }

    @media (min-width: 768px) {
        .summary-header {
            grid-template-columns: auto 1fr;
            align-items: center;
        }
    }

    .average-section {
        text-align: center;
        padding: 1rem;
    }

    @media (min-width: 768px) {
        .average-section {
            text-align: left;
            border-right: 1px solid #e5e7eb;
            padding-right: 2rem;
        }
    }

    .average-number {
        font-size: 3.5rem;
        font-weight: 800;
        color: #111827;
        line-height: 1;
        margin-bottom: 0.5rem;
    }

    .total-reviews {
        margin-top: 0.5rem;
        color: #6b7280;
        font-size: 0.9375rem;
        font-weight: 500;
    }

    .distribution-section {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .rating-row {
        display: grid;
        grid-template-columns: auto auto 1fr auto;
        align-items: center;
        gap: 0.75rem;
    }

    .rating-label {
        font-weight: 600;
        color: #374151;
        font-size: 0.9375rem;
        width: 12px;
    }

    .star-small {
        width: 16px;
        height: 16px;
        color: #f59e0b;
        flex-shrink: 0;
    }

    .progress-bar-container {
        height: 8px;
        background: #e5e7eb;
        border-radius: 9999px;
        overflow: hidden;
        flex: 1;
    }

    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #f59e0b, #fbbf24);
        border-radius: 9999px;
        transition: width 0.3s ease;
    }

    .rating-count {
        font-size: 0.875rem;
        color: #6b7280;
        font-weight: 500;
        min-width: 30px;
        text-align: right;
    }
</style>
