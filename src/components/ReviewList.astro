---
import type { Review } from "../data/reviews";
import StarRating from "./StarRating.astro";

interface Props {
    reviews: Review[];
    maxReviews?: number;
}

const { reviews, maxReviews = 5 } = Astro.props;
const displayReviews = reviews.slice(0, maxReviews);

function formatDate(dateString: string): string {
    const date = new Date(dateString);
    return date.toLocaleDateString("es-CL", {
        year: "numeric",
        month: "long",
        day: "numeric",
    });
}
---

<div class="review-list">
    {
        displayReviews.length === 0 ? (
            <div class="no-reviews">
                <svg
                    class="no-reviews-icon"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"
                    />
                </svg>
                <p class="no-reviews-text">
                    Aún no hay reseñas para este producto
                </p>
                <p class="no-reviews-subtext">
                    ¡Sé el primero en compartir tu opinión!
                </p>
            </div>
        ) : (
            <>
                {displayReviews.map((review) => (
                    <article class="review-item">
                        <div class="review-header">
                            <div class="review-author">
                                <div class="author-avatar">
                                    {review.userName.charAt(0).toUpperCase()}
                                </div>
                                <div class="author-info">
                                    <div class="author-name-row">
                                        <span class="author-name">
                                            {review.userName}
                                        </span>
                                        {review.verified && (
                                            <span
                                                class="verified-badge"
                                                title="Compra verificada"
                                            >
                                                <svg
                                                    class="verified-icon"
                                                    xmlns="http://www.w3.org/2000/svg"
                                                    viewBox="0 0 20 20"
                                                    fill="currentColor"
                                                >
                                                    <path
                                                        fill-rule="evenodd"
                                                        d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                                        clip-rule="evenodd"
                                                    />
                                                </svg>
                                                Verificado
                                            </span>
                                        )}
                                    </div>
                                    <div class="review-meta">
                                        <StarRating
                                            rating={review.rating}
                                            size="sm"
                                        />
                                        <span class="review-date">
                                            {formatDate(review.date)}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="review-content">
                            <h4 class="review-title">{review.title}</h4>
                            <p class="review-comment">{review.comment}</p>
                        </div>

                        <div class="review-footer">
                            <button
                                class="helpful-btn"
                                data-review-id={review.id}
                            >
                                <svg
                                    class="helpful-icon"
                                    xmlns="http://www.w3.org/2000/svg"
                                    fill="none"
                                    viewBox="0 0 24 24"
                                    stroke="currentColor"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"
                                    />
                                </svg>
                                Útil ({review.helpful})
                            </button>
                        </div>
                    </article>
                ))}

                {reviews.length > maxReviews && (
                    <button class="show-more-btn">
                        Ver todas las reseñas ({reviews.length})
                    </button>
                )}
            </>
        )
    }
</div>

<style>
    .review-list {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
    }

    .no-reviews {
        text-align: center;
        padding: 3rem 1rem;
        background: #f9fafb;
        border-radius: 0.75rem;
    }

    .no-reviews-icon {
        width: 64px;
        height: 64px;
        color: #d1d5db;
        margin: 0 auto 1rem;
    }

    .no-reviews-text {
        font-size: 1.125rem;
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.5rem;
    }

    .no-reviews-subtext {
        color: #6b7280;
        font-size: 0.9375rem;
    }

    .review-item {
        padding: 1.5rem;
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        transition: box-shadow 0.2s;
    }

    .review-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .review-header {
        margin-bottom: 1rem;
    }

    .review-author {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
    }

    .author-avatar {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3b82f6, #2563eb);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 1.25rem;
        flex-shrink: 0;
    }

    .author-info {
        flex: 1;
    }

    .author-name-row {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.25rem;
    }

    .author-name {
        font-weight: 600;
        color: #111827;
        font-size: 0.9375rem;
    }

    .verified-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        background: #dbeafe;
        color: #1e40af;
        padding: 0.125rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .verified-icon {
        width: 14px;
        height: 14px;
    }

    .review-meta {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }

    .review-date {
        font-size: 0.8125rem;
        color: #6b7280;
    }

    .review-content {
        margin-bottom: 1rem;
    }

    .review-title {
        font-size: 1rem;
        font-weight: 600;
        color: #111827;
        margin-bottom: 0.5rem;
    }

    .review-comment {
        color: #4b5563;
        line-height: 1.6;
        font-size: 0.9375rem;
    }

    .review-footer {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding-top: 1rem;
        border-top: 1px solid #f3f4f6;
    }

    .helpful-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        background: transparent;
        border: 1px solid #e5e7eb;
        padding: 0.5rem 0.875rem;
        border-radius: 0.5rem;
        color: #6b7280;
        font-size: 0.875rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
    }

    .helpful-btn:hover {
        background: #f9fafb;
        border-color: #d1d5db;
        color: #374151;
    }

    .helpful-icon {
        width: 16px;
        height: 16px;
    }

    .show-more-btn {
        align-self: center;
        background: white;
        border: 2px solid #2563eb;
        color: #2563eb;
        padding: 0.75rem 2rem;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s;
    }

    .show-more-btn:hover {
        background: #2563eb;
        color: white;
    }
</style>
